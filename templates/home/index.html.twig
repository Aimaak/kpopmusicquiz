{% extends 'base.html.twig' %}

{% block body %}
	<style>
		.container {
			display: flex;
			justify-content: center;
			align-items: center;
		}
	</style>
	<div class="container">
		<button id="play-btn">Play!</button>
		<input type="text" name="guess" id="guess-box" placeholder="Type your guess">
	</div>

	<div id="tracks" data-tracks="{{ tracks|json_encode() }}"></div>

	<script>
		var tracksDiv = document.getElementById('tracks');
		var tracks = JSON.parse(tracksDiv.dataset.tracks);
		tracksDiv.remove();

		const playBtn = document.getElementById('play-btn');
		playBtn.addEventListener('click', function () {
			let firstSongIndex = Math.floor(Math.random() * tracks.length);
			playSong(firstSongIndex);
		});

		function playSong(index) {
			console.log(tracks);
			var audio = new Audio(tracks[index].url);
			audio.play();

			audio.addEventListener('ended', function() {
				playNextSong(index);
			})
		}

		function playNextSong(previousIndex) {
			tracks.splice(previousIndex, 1);

			if (tracks.length == 0) {
				return endGame();
			}

			pauseUntilNextSong();
		}

		function endGame() {
			alert('Game has ended');
		}

		function pauseUntilNextSong() {
			setTimeout(() => {
				playSong(Math.floor(Math.random() * tracks.length));
			}, 5000);
		}
	</script>
{% endblock %}
